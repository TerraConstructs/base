# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

TerraConstructs is a TypeScript library that provides AWS CDK-like constructs for infrastructure as code, built on top of CDKTF (Terraform CDK). It combines AWS CDK patterns with Terraform's provider ecosystem and state management capabilities.

## Development Commands

### Core Development Workflow

- `pnpm install` - Install dependencies, dependencies must be added in `./.projen.ts`
- `pnpm compile` - Compile TypeScript to JavaScript (required before integration tests)
- `pnpm build` - Full build including compile, test, and package
- `pnpm jest --passWithNoTests --updateSnapshot --coverage=false ./test/aws/compute/launch-template.test.ts` - run test for one test file only
- `pnpm test` - Run All Jest unit tests (likely exceed memory and crash)
- `pnpm test:watch` - Run tests in watch mode
- `pnpm eslint` - Run ESLint for code quality

### Integration Testing

- **IMPORTANT**: Must run `pnpm compile` before integration tests (terratest uses compiled `lib` folder)
- `go test -v -count 1 -timeout 180m ./...` - Run all integration tests (takes significant time)
- Use individual make targets per service instead: `cd integ/aws/compute && make instance`
- Requires AWS credentials and Bun runtime for synthesis

### Tool Management

- `mise install` - Install correct versions of required tools (Node.js, pnpm, Bun, Go, OpenTofu)
- `mise ls` - View required tool versions

## Architecture

### Code Organization

- `src/` - TypeScript source code organized by architectural module
  - `src/aws/compute/` - EC2, VPC, Lambda, Autoscaling, ELB, ... constructs
  - `src/aws/network/` - legacy networking constructs (to be deprecated, use compute)
  - `src/aws/storage/` - S3, Parameter Store, RDS, DynamoDb, ... constructs
  - `src/aws/iam/` - IAM constructs
  - `src/construct-base.ts` - Base construct class
  - `src/stack-base.ts` - Base stack class
- `lib/` - Compiled JavaScript output
- `test/` - Jest unit tests
- `integ/` - Terratest integration tests

### Key Design Patterns

- **JSII Compatibility**: Library designed for multi-language support
- **Construct Hierarchy**: Base classes provide common functionality
- **AWS CDK Patterns**: Similar abstractions and developer experience
- **Generated Code**: Many configuration files are auto-generated by Projen

### Dependencies

- **CDKTF** (0.20.8) - Core Terraform CDK framework
- **AWS Provider** (19.54.0) - Primary cloud provider
- **JSII** (~5.7) - Multi-language library generation
- **Projen** (^0.88.0) - Project synthesis and configuration management

## Testing Strategy

### Unit Tests (Jest)

- Custom setup in `setup.js` for CDKTF testing
- Assertions helpers in `test/assertions.ts`
- Snapshot testing supported for template validation

### Integration Tests (Terratest)

- Real AWS resource deployment and validation
- Modular tests using same categories as the library in `integ/aws/`
- Automatic resource cleanup after tests
- Requires compiled `lib` folder and AWS credentials

## Important Notes

- **Generated Files**: Many files are auto-generated by Projen - modify `.projenrc.ts` instead
- **Package Manager**: Uses pnpm (9.9.0) exclusively
- **Node.js Version**: Requires >=18.18.0
- **Multi-language**: Supports Python, Go, Java via JSII compilation
- **License**: GPL-3.0-or-later
